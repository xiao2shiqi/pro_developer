# Activiti æµç¨‹å¼•æ“çš„ä½¿ç”¨

## æµç¨‹å¼•æ“çš„é…ç½®

ProcessEngineConfiguration å¯¹è±¡å°±å¯ä»¥ä»£è¡¨ Activiti çš„å…¨éƒ¨é…ç½®ã€‚é€šå¸¸ä¹Ÿæ˜¯é»˜è®¤ `activiti.cfg.xml` æ–‡ä»¶å¿…é¡»å£°æ˜çš„ bean å¯¹è±¡

### æµç¨‹å¯¹è±¡é…ç½®

ProcessEngineConfiguration å¯¹è±¡é»˜è®¤è¯»å–ä»¥ä¸‹ä¿¡æ¯ï¼š
1. åˆ° ClassPath ç›®å½•ä¸‹è¯»å–åä¸º `activiti.cfg.xml` çš„é…ç½®æ–‡ä»¶
2. å¹¶ä¸”è§£æ XML å’Œåˆ›å»º `processEngineConfiguration` å®ä¾‹

é€šå¸¸ä¸€ä¸ªåŒ…å« dbcp è¿æ¥æ± çš„ `activiti.cfg.xml` æ–‡ä»¶ä¿¡æ¯å¦‚ä¸‹ï¼š
```xml
    <!--dbcpé“¾æ¥æ± -->
    <bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource">
        <property name="driverClassName" value="com.mysql.jdbc.Driver"/>
        <property name="url" value="jdbc:mysql://localhost:3306/activiti?characterEncoding=utf8"/>
        <property name="username" value="root"/>
        <property name="password" value="123456"/>
        <property name="maxActive" value="15"/>
        <property name="maxIdle" value="1"/>
        <property name="defaultAutoCommit" value="false" />
    </bean>

    <!--åœ¨é»˜è®¤æ–¹å¼ä¸‹çš„ processEngineConfiguration -->
    <bean id="processEngineConfiguration"  class="org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration">
        <!--ç›´æ¥å¼•ç”¨ä¸Šé¢é…ç½®çš„é“¾æ¥æ± ï¼Œæ›´é«˜æ•ˆ-->
        <property name="dataSource" ref="dataSource" />
        <!-- æ„å»ºå¼•æ“æ—¶ï¼Œæ£€æŸ¥å¹¶åœ¨éœ€è¦æ—¶æ›´æ–°è¡¨ç»“æ„ã€‚è¡¨ç»“æ„ä¸å­˜åœ¨åˆ™ä¼šåˆ›å»ºã€‚ -->
        <property name="databaseSchemaUpdate" value="true"/>
        <property name="asyncExecutorActivate" value="false" />
    </bean>
```


å…³äºæµç¨‹å¼•æ“é…ç½®æ–‡ä»¶ï¼ŒProcessEngineConfiguration è¿˜æä¾›å¦‚ä¸‹å‡ ç§æ–¹å¼å®ç°ï¼š
1. è¯»å–è‡ªå®šä¹‰æ–‡ä»¶ï¼šé€šè¿‡ `createProcessEngineConfigurationFromResource` æ–¹æ³•å®ç°
2. è¯»å–è¾“å…¥æµï¼šé€šè¿‡ `createProcessEngineConfigurationFromInputStream` æ–¹æ³•å®ç°
3. æ— éœ€å‚æ•°çš„é»˜è®¤é…ç½®å¯¹è±¡ï¼šé€šè¿‡ `createStandaloneInMemProcessEngineConfiguration` å®ç°
4. â€¦â€¦â€¦â€¦â€¦â€¦ 

å› ä¸ºä»¥ä¸Šæ–¹æ³•éƒ½ä¸æ˜¯å¾ˆå¸¸ç”¨ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚

### æ•°æ®æºé…ç½®

**æ•°æ®æºé…ç½®**
Activiti æ”¯æŒçš„æ•°æ®åº“ç±»å‹ï¼š
- H2ï¼ˆæœ¬åœ°æµ‹è¯•ç”¨ï¼‰
- MySQL
- Oracle
- PostgreSQL
- DB2
- MSSQL

ä¸Šé¢å±•ç¤ºäº† `processEngineConfiguration` é…ç½®å’Œ `dbcp` ç»“åˆä½¿ç”¨çš„æ¡ˆä¾‹ï¼Œè¿™é‡Œä¹Ÿä¸èµ˜è¿°äº†ã€‚  
åœ¨ Activiti ä¸­å¸¸ç”¨çš„è¿æ¥æ•°æ®æºæ–¹æ³•æœ‰ä»¥ä¸‹å‡ ç§ï¼š

processEngineConfiguration ä¸­ `dataSource` å¯ä»¥æ”¯æŒçš„æ•°æ®æºç±»å‹æœ‰ï¼š
- JDBC é…ç½®
- DBCP é…ç½®ï¼ˆä¸Šé¢æ¡ˆä¾‹ï¼‰
- C3P0 é…ç½®ï¼ˆè·Ÿ DBCP å¤§åŒå°å¼‚ï¼‰

**æ•°æ®åº“ç­–ç•¥é…ç½®**

processEngineConfiguration ä¸­ databaseSchemaUpdate å±æ€§çš„ä¸‰ç§ç­–ç•¥ï¼š

1. falseï¼šæ£€æŸ¥æ•°æ®åº“ä¸­çš„ä¾èµ–è¡¨ï¼Œå¦‚æœæ²¡æœ‰è¡¨æˆ–è¡¨ä¸­çš„ç‰ˆæœ¬ä¸åŒ¹é…ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸
2. trueï¼šè‡ªåŠ¨æ›´æ–°æ•°æ®åº“ä¸­çš„è¡¨è¿›è¡Œæ›´æ–°ï¼ˆæ²¡æœ‰è¡¨åˆ™è‡ªåŠ¨åˆ›å»ºï¼‰ï¼ŒåŒ¹é…åˆ™ä¸åšä»»ä½•äº‹æƒ…ï¼ˆå¸¸ç”¨é€‰é¡¹ï¼‰
3. create-dropï¼šæ¯æ¬¡é‡å¯ Activiti éƒ½ä¼šåˆ é™¤æ•°æ®åº“ï¼Œé‡æ–°å»ºç«‹è¡¨ç»“æ„ï¼ˆå¤šç”¨äºå•å…ƒæµ‹è¯•ï¼‰

æ³¨æ„ï¼š
1. Activiti åªä¼šåœ¨æµç¨‹å¼•æ“åˆ›å»ºæ—¶ã€æŒ‰ç…§é…ç½®çš„ç­–ç•¥è¿›è¡Œåˆ›å»ºï¼Œè¯»å–å¼•æ“é…ç½®çš„æ—¶å€™å¹¶ä¸ä¼šåˆ›å»ºè¡¨ç»“æ„
2. Activiti ä¼šæ ¹æ®ä½ çš„ JDBC ä¿¡æ¯åˆ¤æ–­ä½ ä½¿ç”¨çš„æ•°æ®åº“ç±»å‹ï¼Œæ— éœ€å•ç‹¬å£°æ˜ databaseType å±æ€§ï¼ˆæ˜¾çš„å¤šæ¬¡ä¸€ä¸¾ï¼‰


### å…¶ä»–å±æ€§é…ç½®

**å†å²ä¿¡æ¯ history é…ç½®**

å†å²ä¿¡æ¯åœ¨ processEngineConfiguration å¯¹è±¡ä¸­é…ç½®æ–¹å¼å¦‚ä¸‹ï¼š

```xml
<property name="history" value="audit" />
```
å®ƒçš„å››ç§ value åˆ†åˆ«ä»£è¡¨çš„å«ä¹‰æ˜¯ï¼š
- noneï¼šä¸ä¿å­˜ä»»ä½•å†å²æ•°æ®ï¼Œå¯ä»¥è®©å¼•æ“æœ€é«˜æ•ˆé¢çš„è¿è¡Œ
- activityï¼šä¿å­˜æµç¨‹å®ä¾‹å’Œæµç¨‹è¡Œä¸ºï¼Œç›¸æ¯” none çº§åˆ«é«˜ä¸€ç‚¹
- auditï¼šè¿˜ä¼šä¿å­˜æµç¨‹ä»»åŠ¡å’Œæ•°æ®å±æ€§ï¼Œæ˜¯ `history` çš„é»˜è®¤å€¼
- fullï¼šæœ€é«˜çº§åˆ«ï¼Œé™¤äº† audit å…¨éƒ¨æ•°æ®å¤–ï¼Œè¿˜ä¼šä¿å­˜æµç¨‹ç›¸å…³çš„ç»†èŠ‚æ•°æ®ï¼Œä¸è¿‡æ€§èƒ½ä¼šæ¯”è¾ƒä½

asyncExecutorActivate å¼‚æ­¥æ‰§è¡Œå™¨ï¼šé»˜è®¤ä¸º false
mailServer* é‚®ä»¶æœåŠ¡å™¨é…ç½®ï¼šå‘é€é‚®ä»¶çš„æœåŠ¡

### æµç¨‹å¯¹è±¡åˆ†æ

å‰é¢ä»‹ç»äº† ProcessEngineConfiguration çš„å±æ€§é…ç½®å’Œä½œç”¨ï¼Œä¸‹é¢çœ‹çœ‹å®ƒçš„ç»§æ‰¿å…³ç³»

**æµç¨‹å¯¹è±¡çš„å­ç±»å’Œç”¨é€”ï¼š**  

- StandalongeProcessEngineConfigurationï¼šé»˜è®¤ä¼šå¯¹ Activiti è¿›è¡Œäº‹åŠ¡ç®¡ç†ï¼Œå¯åŠ¨æ—¶ä¼šæ£€æŸ¥æ•°æ®åº“ç»“æ„å’Œç‰ˆæœ¬æ˜¯å¦æ­£ç¡® âœ…
- StandalongInMemProcessEngineConfigurationï¼šå…·æœ‰äº‹åŠ¡ç®¡ç†ï¼Œå¹¶ä¸”è®¾ç½® `databaseSchemaUpdate`ã€`jdbcUrl` å±æ€§ï¼Œæ–¹ä¾¿è¿›è¡Œå•å…ƒæµ‹è¯•
- SpringProcessEngineConfigurationï¼šä»åå­—ä¸Šçœ‹å°±çŸ¥é“æ˜¯è·Ÿ Spring æ•´åˆçš„ç±»
- JtaProcessEngineï¼šä½¿ç”¨ Jta è¿›è¡Œäº‹åŠ¡ç®¡ç†çš„ç±»

ä¸€äº›è‡ªå®šä¹‰çš„é…ç½®ï¼š
- è‡ªå®šä¹‰é…ç½®ï¼šç»§æ‰¿ ProcessEngineConfigurationImplï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸€äº›å±æ€§
- è‡ªå®šä¹‰æ‹¦æˆªå™¨ï¼šè¦†ç›– ProcessEngineConfigurationImpl çš„ `initCommandInterceptors()` æ–¹æ³•

## æµç¨‹å¼•æ“çš„åˆ›å»º


### åˆ›å»ºçš„æ–¹å¼

ProcessEngine å®ä¾‹ä»£è¡¨ä¸€ä¸ªæµç¨‹å¼•æ“ï¼ˆè¯»é…ç½®æ–‡ä»¶åˆ›å»ºï¼‰ã€‚é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼Œä¸»è¦æ˜¯è·å– ProcessEngine å¯¹è±¡å®ä¾‹

```java
// ä» ProcessEngineConfiguration ä¸­æ„å»º ProcessEngine å®ä¾‹
ProcessEngine processEngine = ProcessEngineConfiguration.createProcessEngineConfigurationFromResourceDefault().buildProcessEngine();
// ä» ProcessEngines ä¸­è·å–é»˜è®¤çš„ ProcessEngine å®ä¾‹
ProcessEngine defaultProcessEngine = ProcessEngines.getDefaultProcessEngine();
// è·å–å½“å‰æ‰€æœ‰æµç¨‹çš„å®ä¾‹ Map
Map<String, ProcessEngine> processEngines = ProcessEngines.getProcessEngines();
// æ‰“å°æµç¨‹å®ä¾‹å±æ€§
Assert.assertNotEquals(processEngine, defaultProcessEngine);
// å½“å‰æµç¨‹å®ä¾‹æ•°é‡
Assert.assertEquals(processEngines.size(), 1);
Assert.assertEquals(processEngines.get("default"), defaultProcessEngine);
```

å› ä¸ºå¯ä»¥è‡ªå®šä¹‰ xml é…ç½®æ–‡ä»¶ï¼Œåˆ›å»ºåŸºäºä¸åŒé…ç½®æ–‡ä»¶çš„ `ProcessEngine` å¯¹è±¡ï¼Œæ‰€ä»¥ Activiti æä¾›äº†ä¸€ç³»åˆ—å¯¹ `ProcessEngine` å¯¹è±¡çš„æ³¨å†Œã€é‡è½½ã€åˆ é™¤æ–¹æ³•ï¼ˆå› ä¸ºä½¿ç”¨æ¯”è¾ƒç®€å•ï¼Œè€Œä¸”é¢‘ç‡æ¯”è¾ƒä½ï¼Œè¿™é‡Œå°±ä¸å±•ç¤ºä»£ç äº†ï¼Œç®€å•è¯´ä¸€ä¸‹åŠŸèƒ½å³å¯ï¼Œéœ€è¦çš„æ—¶å€™å†æŸ¥ï¼‰ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š
1. registerProcessEngine(ProcessEngine processEngine)ï¼šå‘ ProcessEngines æ³¨å†Œä¸€ä¸ª ProcessEngine å®ä¾‹ï¼ˆè®°å¾—å…ˆä»è‡ªå®šä¹‰é…ç½®ä¸­åˆ›å»º ProcessEngine å¯¹è±¡ï¼‰
2. unregister(ProcessEngine processEngine)ï¼šå‘ ProcessEngines æ³¨é”€ä¸€ä¸ª ProcessEngine å®ä¾‹ï¼ˆæœ¬è´¨åªæ˜¯å¯¹ Map çš„ add/remove æ“ä½œè€Œå·²ï¼‰
3. retry(String resourceUrl)ï¼šé‡è½½æ‰§è¡ŒåŠ è½½ Activiti é…ç½®æ–‡ä»¶åŠ¨ä½œï¼Œè·å– ProcessEngineInfo å¯¹è±¡
4. destory()ï¼šé”€æ¯ ProcessEngines ä¸­çš„æ‰€æœ‰æµç¨‹å®ä¾‹

### æµç¨‹å¯¹è±¡çš„å†…å®¹

Activiti å¯¹æµç¨‹çš„æ“ä½œé›†ä¸­åœ¨å‡ ä¸ªæœåŠ¡ç»„ä»¶å†…ï¼Œä»–ä»¬åˆ†åˆ«çš„èŒè´£æ˜¯ï¼šï¼ˆåé¢ä¼šè¯¦ç»†è¯´æ˜ç»„ä»¶çš„ç»†åˆ†ï¼‰
- RepositoryServiceï¼šæä¾›å¯¹äºæµç¨‹å®šä¹‰ã€æµç¨‹éƒ¨ç½²çš„æœåŠ¡
- RuntimeServiceï¼šæä¾›å¯¹äºæµç¨‹è¿è¡Œã€æµç¨‹å®ä¾‹çš„ç®¡ç†å’Œæ§åˆ¶æœåŠ¡
- TaskServiceï¼šæä¾›å¯¹æµç¨‹ä»»åŠ¡çš„ç®¡ç†å’Œæ§åˆ¶ï¼Œä¾‹å¦‚ä»»åŠ¡æé†’ï¼Œä»»åŠ¡å®Œæˆå’Œåˆ›å»ºä»»åŠ¡
- IdentityServiceï¼šå¯¹äºæµç¨‹æ•°æ®è§’è‰²ç®¡ç†çš„ API æœåŠ¡ã€åŒ…æ‹¬ç”¨æˆ·ç»„ï¼Œç”¨æˆ·ä¹‹é—´çš„å…³ç³»
- ManagementServiceï¼šæä¾›å¯¹äºå¼•æ“çš„ç®¡ç†å’Œç»´æŠ¤æœåŠ¡
- HistoryServiceï¼šæä¾›å¯¹æµç¨‹å†å²çš„æ“ä½œæœåŠ¡ï¼Œä¾‹å¦‚æŸ¥çœ‹å†å²ã€åˆ é™¤å†å²æ•°æ®ç­‰
- DynamicBpmnServiceï¼šå¯ä»¥å®ç°æ— éœ€é‡æ–°éƒ¨ç½²ï¼Œå³å¯ä¿®æ”¹æµç¨‹æ¨¡å‹çš„éƒ¨åˆ†ä¿®æ”¹


ä» ProcessEngine å¯¹è±¡ä¸­è·å–å„ä¸ªæµç¨‹ç»„ä»¶çš„æ–¹å¼ï¼š
```java
// ä» processEngine å®ä¾‹ä¸­è·å–å„å¤§åŠŸèƒ½ç»„ä»¶
RepositoryService repositoryService = processEngine.getRepositoryService();
RuntimeService runtimeService = processEngine.getRuntimeService();
TaskService taskService = processEngine.getTaskService();
ManagementService managementService = processEngine.getManagementService();
HistoryService historyService = processEngine.getHistoryService();
DynamicBpmnService dynamicBpmnService = processEngine.getDynamicBpmnService();
```

å¦å¤–å‡ ä¸ªæ“ä½œ ProcessEngine å¯¹è±¡æ–¹æ³•ï¼š
- close å…³é—­å¼•æ“
- setProcessEngieName(String name) è®¾ç½®å¼•æ“çš„åç§°
- getProcessEngie(String name) æ ¹æ®è·å–å¼•æ“åç§°è·å–å®ä¾‹


## ç”¨æˆ·å’Œç»„çš„æ¦‚å¿µ

### åŸºæœ¬ä½¿ç”¨
ç”¨æˆ·ç»„çš„ä¸€äº›åŸºæœ¬æ“ä½œï¼ˆå®é™…ä¸Šæ˜¯å¯¹ `ACT_ID_GROUP` è¡¨çš„æ“ä½œï¼‰å¦‚ä¸‹ï¼š
```java
IdentityService identityService = processEngine.getIdentityService();
// åˆ›å»ºç»„
String genId = UUID.randomUUID().toString();
Group newGroup = identityService.newGroup(genId);
newGroup.setName("éƒ¨é—¨ç»ç†");
newGroup.setType("manager");
identityService.saveGroup(newGroup);
// æŸ¥è¯¢ç”¨æˆ·ç»„
Group result = identityService.createGroupQuery().groupId(genId).singleResult();
System.out.println("Group ID:" + result.getId() + ", Name: " + result.getName());

// => Group ID:e47d6797-a6fb-4694-8fbb-d25d6d4afd53, Name: éƒ¨é—¨ç»ç†
```

### åŸºæœ¬æŸ¥è¯¢
å…¶å®æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥ä½¿ç”¨ä¸€ä¸‹æ–¹å¼è¿›è¡ŒæŸ¥è¯¢ï¼Œæ‰€ä»¥å·²ç»æ˜¯é€šç”¨å‹æŸ¥è¯¢
```java
// è·å–æ¨¡å—æœåŠ¡ç»„ä»¶
IdentityService identityService = processEngine.getIdentityService();
// è·å–å¯¹è±¡çš„å…¨éƒ¨é›†åˆ
identityService.createGroupQuery().list();
// åˆ†é¡µæŸ¥è¯¢
identityService.createGroupQuery().listPage(0, 5);
// åˆè®¡
identityService.createGroupQuery().count();
// æ’åºæŸ¥è¯¢ asc(), desc() ç¤ºä¾‹ ï¼ˆå•å­—æ®µï¼Œå¤šå­—æ®µæŸ¥è¯¢ï¼Œä¸å†èµ˜è¿°äº†â€¦â€¦ğŸ˜¶â€ğŸŒ«ï¸ï¼‰
identityService.createGroupQuery().orderByGroupId().asc().list();
// åŒ¹é…å•æ¡è®°å½•ï¼ˆæ‰¾ä¸åˆ°æˆ–è€…æ‰¾åˆ°å¤šæ¡éƒ½ä¼šæŠ¥é”™ï¼Œæ…ç”¨ï¼ï¼‰
identityService.createGroupQuery().singleResult();
// åŸç”Ÿæ–¹å¼æŸ¥è¯¢æ•°æ®ç¤ºä¾‹ï¼ˆä¸æ¨èï¼Œå¯¼è‡´è€¦åˆï¼‰
identityService.createNativeGroupQuery().sql("select * from ACT_ID_GROUP").list();    // => 1

// more method ...
// â€¦â€¦â€¦â€¦â€¦â€¦ è¿˜å°è£…äº†æ›´å¤šç›¸å…³çš„æŸ¥è¯¢ï¼Œè¿™é‡Œå°±åœ¨ä¸€ä¸€å±•ç¤ºäº†ï¼Œæ¯•ç«Ÿæ˜¯ç¬”è®°ï¼Œä¸æ˜¯ API
```

### å…³è”å…³ç³»

ACT_ID_* è¡¨ä¹‹é—´çš„å…³ç³»

![UserGroupRelation](https://pcloud-1258173945.cos.ap-guangzhou.myqcloud.com/uPic/PKiXfW.png)

## æµç¨‹å­˜å‚¨

åœ¨ Avtiviti ä¸­ï¼Œæµç¨‹å¼•æ“å¯¹èµ„æºæ–‡ä»¶ï¼ˆBPMNï¼‰çš„ç®¡ç†ã€å®šä¹‰éƒ½æ˜¯ RepositoryService çš„èŒè´£ï¼Œæˆ‘ä»¬è¿™é‡Œä¸»è¦ä»‹ç» RepositoryService ç»„ä»¶çš„ä½¿ç”¨

### éƒ¨ç½²å¯¹è±¡

è¿™é‡Œä¸»è¦ä»‹ç» Deploymentã€DeploymentBuilder å¯¹è±¡ï¼Œ  
ä»–ä»¬éƒ½æ˜¯ RepositoryService é‡è¦çš„éƒ¨ç½²å¯¹è±¡ï¼Œä»–ä»¬çš„èŒè´£åˆ†åˆ«å¦‚ä¸‹ï¼š
- Deploymentï¼šä»£è¡¨ä¸€æ¡ ACT_RE_DEPLOYMENT æ•°æ®ï¼Œä¿å­˜æµç¨‹å®šä¹‰çš„å…³é”®ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šéƒ¨ç½²åç§°ã€
- DeploymentBuilderï¼šä¸»è¦çš„æµç¨‹éƒ¨ç½²å¯¹è±¡ï¼Œå¯ä»¥å¯¹ï¼šresourceï¼ŒInputStreamï¼ŒZipã€BpmnModelã€Bytes ç­‰å¯¹è±¡è¿›è¡Œéƒ¨ç½²

éƒ¨ç½²ä¸€ä¸ªæµç¨‹æ–‡ä»¶ç¤ºä¾‹ï¼š
```java
RepositoryService repositoryService = processEngine.getRepositoryService();
// éƒ¨ç½²ä¸€ä¸ªæµç¨‹æ–‡ä»¶
DeploymentBuilder deployment = repositoryService.createDeployment();
deployment.name("workoff_process").tenantId("tenantId").key("myKey").category("category").addClasspathResource("bpmn/workoff_process_3.bpmn");
deployment.deploy();

// éƒ¨ç½²åå³å¯åœ¨ ACT_RE_DEPLOYMENT çœ‹åˆ°æ•°æ®

// æ›´å¤šéƒ¨ç½²æ–¹æ³•è¿™é‡Œå°±ä¸å±•ç¤ºäº†ï¼Œæ„Ÿè§‰æ²¡å¿…è¦æ¬è¿ API
```

DeploymentBuilder è¿˜æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼Œæœ‰éœ€è¦çš„æ—¶å€™å¯ä»¥æŸ¥æ¥ä½¿ç”¨
- ä¿®æ”¹éƒ¨ç½²ä¿¡æ¯ï¼šä¸»è¦æ˜¯ä¿®æ”¹ ACT_RE_DEPLOYMENT è¡¨ä¸­çš„å­—æ®µä¿¡æ¯
- è¿‡æ»¤é‡å¤éƒ¨ç½²ï¼šä¸»è¦æ˜¯é€šè¿‡ `endbleDuplicateFiltering()` æ–¹å¼å®ç°
- å–æ¶ˆéªŒè¯ BPMN è§„èŒƒï¼šè°ƒç”¨ `disableSchemaValidation` å’Œ `disableBpmnValidation` æ–¹å¼å®ç°


**åˆ é™¤éƒ¨ç½²çš„æµç¨‹**

repositoryService æä¾›ä¸¤ä¸ªæ–¹å¼æ¥åˆ é™¤å·²éƒ¨ç½²çš„æµç¨‹ï¼Œå› ä¸ºå¤ªç®€å•å°±ä¸è´´ä»£ç å±•ç¤ºäº†ï¼š
- deleteDeployment(String deploymentId)ï¼šåˆ é™¤éƒ¨ç½²æµç¨‹ï¼Œä¸çº§è”åˆ é™¤
- deleteDeployment(String deploymentId, boolean cascade)ï¼šå‚æ•° cascade ä¸º trueï¼Œè¿›è¡Œçº§è”åˆ é™¤

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸ç®¡æ˜¯å¦çº§è”åˆ é™¤ï¼Œéƒ½ä¼šåˆ é™¤ä»¥ä¸‹æ•°æ®ï¼š
- éƒ¨ç½²èµ„æºç›¸å…³ï¼ˆResourceï¼‰
- éƒ¨ç½²ç›¸å…³æ•°æ®ï¼ˆDeploymentï¼‰
- æµç¨‹å®šä¹‰æ•°æ®ï¼ˆProcessDefinitionï¼‰
- æµç¨‹å’Œèº«ä»½å…³è”æ•°æ®ï¼ˆIdentityLinkï¼‰

å¦‚æœæ˜¯çº§è”åˆ é™¤ï¼Œè¿˜åŒ…å«ä»¥ä¸‹æ•°æ®ï¼š
- æµç¨‹å®ä¾‹æ•°æ®ï¼ˆProcessInstanceï¼‰
- æµç¨‹ä»»åŠ¡æ•°æ®ï¼ˆTaskï¼‰
- æµç¨‹å†å²æ•°æ®ï¼ˆHistoryï¼‰

**æ³¨æ„ï¼šå¦‚æœæµç¨‹å®ä¾‹å·²ç»å­˜åœ¨ï¼ˆProcessInstanceï¼‰ï¼Œå¦‚æœä¸è¿›è¡Œçº§è”åˆ é™¤çš„è¯ï¼ˆé»˜è®¤åˆ é™¤ï¼‰ï¼Œåˆ™ä¼šåˆ é™¤å¤±è´¥**

### æµç¨‹å®šä¹‰
`ProcessDefinition` å¯¹è±¡è¡¨ç¤ºä¸€æ¡æµç¨‹å®šä¹‰æ•°æ®ï¼Œå¯¹åº”æ•°æ®è¡¨æ˜¯ `ACT_RE_PROCDEF`

`ProcessDefinition` å¯¹è±¡çš„å‡ ä¸ªåŸºæœ¬ç”¨æ³•ï¼š
```java
// è·å– ProcessDefinition å¯¹è±¡
ProcessDefinition processDefinition = repositoryService.createProcessDefinitionQuery().singleResult();
// è·å– ProcessDefinition å¯¹è±¡å±æ€§
processDefinition.getId();
processDefinition.getKey();
processDefinition.getCategory();
processDefinition.getDeploymentId();
processDefinition.getDescription();
processDefinition.getEngineVersion();

// æµç¨‹çš„ä¸­æ­¢å’Œæ¿€æ´»
repositoryService.suspendProcessDefinitionByKey(processDefinition.getKey());
repositoryService.activateProcessDefinitionByKey(processDefinition.getKey());
```

### æµç¨‹æƒé™

é»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰äººéƒ½å¯ä»¥å¯åŠ¨å®šä¹‰çš„æµç¨‹ï¼Œä½†æ˜¯å¾ˆå¤šæƒ…å†µæŸäº›æµç¨‹åªæœ‰æŒ‡å®šçš„äººã€æˆ–è€…ç”¨æˆ·ç»„æ‰èƒ½å¯åŠ¨ï¼Œä¾‹å¦‚ï¼š
- åªæœ‰é”€å”®äººå‘˜æ‰èƒ½ä½¿ç”¨çš„æŠ¥é”€æµç¨‹
- åªæœ‰ç»ç†æ‰èƒ½å‘èµ·çš„æ¥å¾…è´¹ç”¨
- ç­‰ç­‰â€¦â€¦â€¦â€¦

æ‰€ä»¥ Activiti æä¾› API æ¥ä¸ºå®šä¹‰çš„æµç¨‹è®¾ç½®å¯åŠ¨æƒé™ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š
```java
// è·å– ProcessDefinition å¯¹è±¡
ProcessDefinition processDefinition = repositoryService.createProcessDefinitionQuery().singleResult();
// è·å–ç”¨æˆ·æœåŠ¡
IdentityService identityService = processEngine.getIdentityService();
// åˆ›å»º 3 ä¸ªç”¨æˆ·
for (int i = 1; i <= 3; i++) {
    User user = identityService.newUser("user" + i);
    user.setFirstName("angus" + i);
    user.setLastName("young" + i);
    user.setEmail("abc@123.com");
    user.setPassword("123");
    identityService.saveUser(user);
}
// ç»‘å®šåˆšæ‰åˆ›å»ºçš„ 2 åç”¨æˆ·
repositoryService.addCandidateStarterUser(processDefinition.getId(), "user1");
repositoryService.addCandidateStarterUser(processDefinition.getId(), "user2");
```

æµç¨‹å®šä¹‰å’Œç”¨æˆ·ã€ç”¨æˆ·ç»„ã€Task çš„å…³ç³»éƒ½ä¿å­˜åœ¨ `ACT_RU_IDENTITYLINK` æ•°æ®è¡¨ä¸­ï¼Œæ‰“å¼€å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„ 2 æ¡æ•°æ®ï¼š
![æµç¨‹å®šä¹‰å’Œç”¨æˆ·å…³è”](https://pcloud-1258173945.cos.ap-guangzhou.myqcloud.com/uPic/UiycXa.png)

ä¿å­˜å®Œåï¼Œæˆ‘ä»¬å°±éœ€è¦æŸ¥è¯¢æµç¨‹æƒé™äº†ï¼Œæˆ‘ä»¬çœ‹çœ‹å¦‚ä½•æŸ¥è¯¢æµç¨‹æƒé™ï¼š
```java
ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();
// æ³¨å†ŒæœåŠ¡
RepositoryService repositoryService = processEngine.getRepositoryService();
ProcessDefinition processDefinition = repositoryService.createProcessDefinitionQuery().singleResult();
IdentityService identityService = processEngine.getIdentityService();

// è·å–æŒ‡å®šç”¨æˆ·çš„çš„æµç¨‹æƒé™æ•°æ®
List<ProcessDefinition> processDefinitions = repositoryService.createProcessDefinitionQuery().startableByUser("user1").list();
System.out.println("ç”¨æˆ· user1 æ‹¥æœ‰çš„æµç¨‹å®šä¹‰ä¸ºï¼š");
for (ProcessDefinition definition : processDefinitions) {
    System.out.println(definition.getKey());
}

// è·å–å¯¹è¯¥æµç¨‹å®šä¹‰æœ‰æƒé™çš„ç”¨æˆ·æ•°æ®
List<User> userList = identityService.createUserQuery().potentialStarter(processDefinition.getId()).list();
System.out.println("ä»¥ä¸‹ç”¨æˆ·æœ‰å¯¹æµç¨‹" + processDefinition.getKey() + "çš„æƒé™");
for (User user : userList) {
    System.out.println(user.getId());
}
// è·å–æµç¨‹å…¨éƒ¨çš„ IdentityLink æ•°æ®
List<IdentityLink> linkList = repositoryService.getIdentityLinksForProcessDefinition(processDefinition.getId());
System.out.println("ä¸æµç¨‹å®šä¹‰ç›¸å…³çš„æ•°æ®ä¸ºï¼š" + linkList.size());
```

ä»¥ä¸Šä»£ç æœ€ç»ˆè¾“å‡ºå¦‚ä¸‹ï¼š
```sh
ç”¨æˆ· user1 æ‹¥æœ‰çš„æµç¨‹å®šä¹‰ä¸ºï¼š
Process_1949hx4

ä»¥ä¸‹ç”¨æˆ·æœ‰å¯¹æµç¨‹Process_1949hx4çš„æƒé™
user1
user2

ä¸æµç¨‹å®šä¹‰ç›¸å…³çš„æ•°æ®ä¸ºï¼š2
```

é€šè¿‡æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å‘ç° Activiti å¹¶ä¸ä¼šå¸®ä½ åšä»»ä½•é‰´æƒçš„åŠ¨ä½œï¼Œä»–åªä¼šå‘Šè¯‰ä½ æƒé™æ•°æ®ï¼Œè‡³äºæ˜¯å¦æ‰§è¡Œï¼Œç”±ä½ è‡ªå·±æ ¹æ®ä¸šåŠ¡é€»è¾‘æ¥åˆ¤æ–­ã€‚

### æµç¨‹æŸ¥è¯¢

è·Ÿä¸Šé¢ç”¨æˆ·çš„ä¾‹å­ç›¸ä¼¼ï¼ŒActiviti ä»»ä½•æœåŠ¡ç»„ä»¶éƒ½æœ‰è‡ªå·±çš„æŸ¥è¯¢å¯¹è±¡ï¼Œé€šå¸¸æ˜¯ xxxQuery æ–¹å¼å‘½åï¼Œæˆ‘ä»¬æœ¬ç« æµç¨‹éƒ¨ç½²ã€æµç¨‹å®šä¹‰ä¹Ÿæœ‰è‡ªå·±çš„æŸ¥è¯¢å¯¹è±¡ï¼Œä»–ä»¬çš„è·å–æ–¹å¼å¦‚ä¸‹ï¼š
```java
// Deployment æŸ¥è¯¢å¯¹è±¡
DeploymentQuery deploymentQuery = repositoryService.createDeploymentQuery();
// ProcessDefinition æŸ¥è¯¢å¯¹è±¡
ProcessDefinitionQuery processDefinitionQuery = repositoryService.createProcessDefinitionQuery();
```

æŸ¥è¯¢å¯¹è±¡å†…åŒ…å«ç›¸å…³æœåŠ¡ç»„ä»¶çš„`æŸ¥è¯¢`ã€`æ’åº`ç­‰æ–¹æ³•å¯ä»¥è¿›è¡Œè°ƒç”¨ï¼Œå…³äºæŸ¥è¯¢å¯¹è±¡çš„åŸºæœ¬ä½¿ç”¨ï¼Œå‰é¢åœ¨ç”¨æˆ·æ¨¡å—å·²ç»è®²è§£è¿‡äº†ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚

## ä»»åŠ¡ç®¡ç†

### åˆ›å»ºå’Œåˆ é™¤
æµç¨‹å®ä¾‹åœ¨è¿è¡Œä¸­ä¼šäº§ç”Ÿå¤šä¸ªä»»åŠ¡ï¼ˆTaskï¼‰ï¼Œæ‰€æœ‰çš„ä»»åŠ¡æ•°æ®éƒ½ä¿å­˜åœ¨ `ACT_RU_TASK` è¡¨ä¸­ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¼šç”± Activiti æ ¹æ®æµç¨‹å®ä¾‹éƒ½ä¼šæ ¹æ®é¢„è®¾çš„èŠ‚ç‚¹ï¼Œä¾‹å¦‚ç”¨æˆ·ä»»åŠ¡ï¼Œè„šæœ¬ä»»åŠ¡ç­‰èŠ‚ç‚¹ï¼Œè‡ªåŠ¨åˆ›å»ºä»»åŠ¡ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»ºä»»åŠ¡å®ä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š
```java
// ä»å¼•æ“ä¸­è·å–ä»»åŠ¡æœåŠ¡
TaskService taskService = processEngine.getTaskService();
// æ‰‹åŠ¨åˆ›å»ºä»»åŠ¡1
Task task = taskService.newTask("task for unit test");
taskService.saveTask(task);
// æ‰‹åŠ¨åˆ›å»ºä»»åŠ¡2
Task task2 = taskService.newTask("å®¡æ ¸ä»»åŠ¡");
taskService.saveTask(task2);
```
å¯ä»¥åˆ›å»ºï¼Œä¹Ÿèƒ½åˆ é™¤ï¼Œè€Œä¸”éå¸¸ç®€å•ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š
```java
// åˆ é™¤ä»»åŠ¡
taskService.deleteTask("task for unit test");
```
åˆ é™¤ä»»åŠ¡è¿˜åŒ…å«ä¸€äº›å¯¹çº§è”æ•°æ®çš„åˆ é™¤ï¼Œå¹³æ—¶ä½¿ç”¨æ¯”è¾ƒå°‘ï¼Œè¿™é‡Œå°±ä¸ç›¸ä¿¡å±•å¼€äº†ã€‚


### ä»»åŠ¡æƒé™

ä»»åŠ¡çš„æƒé™å’Œæµç¨‹æƒé™å‡ ä¹ç›¸åŒï¼Œåªæ˜¯æƒé™ä¸»ä½“å˜æˆ Task å¯¹è±¡è€Œå·²ï¼ŒActiviti è¿˜æ˜¯æœ¬ç€ä¸€è´¯çš„è®¾è®¡åŸåˆ™å°±æ˜¯ï¼Œ**åªè´Ÿè´£ä¿å­˜æƒé™å’Œæä¾›æƒé™æ•°æ®ç»™ç”¨æˆ·åˆ¤æ–­ï¼Œå¹¶ä¸ä¼šå¸®ç”¨æˆ·è¿›è¡Œä»»ä½•çš„é‰´æƒè¡Œä¸º**ï¼Œå› ä¸ºé€»è¾‘å‡ ä¹ç›¸åŒï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚

å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒTask çš„æ‰€æœ‰æƒé™æ•°æ®ï¼ˆç”¨æˆ·ã€ç”¨æˆ·ç»„ï¼‰éƒ½æ˜¯ä¿å­˜åœ¨ `ACT_RU_IDENTITYLINK` æ•°æ®è¡¨ä¸­ï¼Œè¿™ä¸€ç‚¹è·Ÿ **æµç¨‹æƒé™** æåº¦ç›¸ä¼¼ï¼Œå°±ä¸èµ˜è¿°äº†ã€‚

è®¾ç½®ä»»åŠ¡æƒé™çš„å‡ ä¸ªå¸¸ç”¨æ–¹æ³•ï¼š
```java
// æ·»åŠ ä»»åŠ¡æƒé™
taskService.addCandidateGroup("task1", "group1");
taskService.addCandidateUser("task2", "user2");
// æ ¹æ®ç”¨æˆ·ç»„è·å–ä»»åŠ¡åˆ—è¡¨
List<Task> taskList = taskService.createTaskQuery().taskCandidateGroup("group1").list();
// æ ¹æ®ç”¨æˆ·ï¼Œè·å–ä»»åŠ¡åˆ—è¡¨
List<Task> taskList1 = taskService.createTaskQuery().taskCandidateUser("user2").list();

// è®¾ç½®ä»»åŠ¡æŒæœ‰äººï¼Œå¤„ç†äºº
taskService.setOwner("task1", "user1");
taskService.setAssignee("task2", "user2");

// ä»ä»»åŠ¡æŒæœ‰äºº || æŒ‡æ´¾äººèº«ä¸Šè·å–ä»»åŠ¡
List<Task> taskList2 = taskService.createTaskQuery().taskOwner("user1").list();
List<Task> taskList3 = taskService.createTaskQuery().taskAssignee("user2").list();

// è®¾ç½®ç”¨æˆ·æƒé™ï¼Œåˆ é™¤ç”¨æˆ·æƒé™ è¿™é‡Œå°±ä¸å±•ç¤ºäº†ï¼Œéƒ½æ˜¯ä¸€äº› API çš„è°ƒç”¨
```


### ä»»åŠ¡å‚æ•°

ä»»åŠ¡å‚æ•°å†³å®šæµç¨‹ä»»åŠ¡çš„èµ°å‘ï¼Œä¾‹å¦‚ï¼šè¯·å‡å¤©æ•° å¯ä»¥ä½œä¸ºä»»åŠ¡å‚æ•°ï¼Œå¤§äº 3 å¤©èµ°æ€»ç›‘å®¡æ‰¹ï¼Œå°äº 3 å¤©èµ°ä¸»ç®¡å®¡æ‰¹ç­‰ç­‰ ã€‚ã€‚  ä»»åŠ¡å‚æ•°ä½¿ç”¨ TaskService ç»„ä»¶è®¾ç½®ï¼Œæ‰€æœ‰ä»»åŠ¡å‚æ•°çš„æ•°æ®éƒ½ä¿å­˜åœ¨ `ACT_RU_VARIABLE` è¡¨ä¸­ã€‚

å…³äºä»»åŠ¡å‚æ•°çš„å‡ ä¸ªçŸ¥è¯†ç‚¹ï¼ˆå¤§æ¦‚çŸ¥é“å°±å¥½ï¼‰
- ä»»åŠ¡å‚æ•°ä½¿ç”¨ `TaskService` çš„ `setVariable` æ–¹æ³•è®¾ç½®
- ä»»åŠ¡å‚æ•°å¯ä»¥ç›´æ¥ä½¿ç”¨åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå¯¹åº” Java å…«ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼‰
- é™¤äº†åŸºæœ¬æ•°æ®ç±»å‹ï¼Œ`setVariable` è¿˜å¯ä»¥è®¾ç½®åºåˆ—åŒ–å¯¹è±¡ï¼ˆå¯¹è±¡å¿…é¡»å®ç° `Serializable` æ¥å£ï¼‰ã€è¢«åºåˆ—åŒ–çš„å¯¹è±¡ä¼šä½¿ç”¨å¤–é”®å…³è”è¢«ä¿å­˜åœ¨ `ACT_GE_BYTEARRAY` è¡¨ä¸­å­˜å‚¨

è®¾ç½®ä»»åŠ¡å‚æ•°ç¤ºä¾‹ï¼š
```java
// è®¾ç½®åŸºæœ¬ç±»å‹å‚æ•°
taskService.setVariable(task.getId(), "arg0", 1024);
taskService.setVariable(task.getId(), "arg1", "String Params...");
```

è·å–ä»»åŠ¡å‚æ•°ç¤ºä¾‹ï¼š
```java
// è·å–æŒ‡å®šç±»å‹å‚æ•°
Integer arg0 = taskService.getVariable(task.getId(), "arg0", Integer.class);
String arg1 = taskService.getVariable(task.getId(), "arg1", String.class);

// output
1024
String Params...
```

Map å‚æ•°ç¤ºä¾‹ï¼ˆå¤šå‚æ•°çš„ä½¿ç”¨åœºæ™¯ï¼‰ï¼š
```java
// map å‚æ•°è®¾ç½®å’Œè·å–
Map<String, Object> hash = new HashMap<>();
hash.put("args0", 10086);
hash.put("args1", "string params");
taskService.setVariables(task.getId(), hash);

Map<String, Object> map = taskService.getVariables(task.getId());
```

**ä»»åŠ¡å‚æ•°ä½œç”¨åŸŸ**  
åªæœ‰ä¸¤ç§ç±»å‹ï¼Œå°±ä¸å±•å¼€è®¨è®ºäº†ï¼š
- setVariableï¼šå…¨æµç¨‹å®ä¾‹å¯ä½¿ç”¨çš„ä»»åŠ¡å‚æ•°
- setVariableLocalï¼šåªæœ‰å½“å‰ä»»åŠ¡å¯ä½¿ç”¨çš„å±€éƒ¨ä»»åŠ¡å‚æ•°

**ä»»åŠ¡é™„ä»¶**  
è¿™é‡Œä¸»è¦ä½¿ç”¨ Attachment å®ä¾‹è¡¨ç¤ºï¼Œä½¿ç”¨é¢‘ç‡æ¯”è¾ƒä½æ‰€æœ‰å…ˆä¸èµ˜è¿°äº†ã€‚
å…³äºé™„ä»¶çš„å‡ ä¸ªçŸ¥è¯†ç‚¹ï¼š
- é™„ä»¶æ“ä½œä½¿ç”¨ `TaskService` ç»„ä»¶å®Œæˆ
- é™„ä»¶çš„ä¿¡æ¯ä¼šå­˜å‚¨åœ¨ ACT_HI_ATTACHMENT é™„ä»¶è¡¨ä¸­ï¼Œå»ºç«‹å…³è”æ˜ å°„åˆ°èµ„æºè¡¨
- çœŸæ­£çš„é™„ä»¶æ•°æ®ï¼Œä¼šå­˜å‚¨åœ¨ ACT_GE_BYTEARRAY èµ„æºè¡¨ä¸­

é™„ä»¶ä¸­å‡ ä¸ªå¸¸ç”¨çš„æ–¹æ³•ï¼š
- createAttachmentï¼šæ·»åŠ é™„ä»¶
- getProcessInstanceAttachmentsï¼šè·å–æµç¨‹ä¸­çš„é™„ä»¶ä¿¡æ¯
- getTaskAttachmentsï¼šè·å–ä»»åŠ¡ä¸‹çš„é™„ä»¶ä¿¡æ¯
- deleteAttachmentï¼šåˆ é™¤é™„ä»¶

**ä»»åŠ¡è¯„è®º**  
æ¯ä¸ªä»»åŠ¡é™¤äº†å®¡æ‰¹ç»“æœï¼šåŒæ„/æ‹’æ¥æ“ä½œå¤–ï¼Œéƒ½ä¼šæ·»åŠ ä¸€äº›è¯„è®ºä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯éƒ½ä½¿ç”¨ Comment å¯¹è±¡ä¿å­˜ã€‚
ä»¥ä¸‹æ˜¯å…³äº Comment å¯¹è±¡çš„å‡ ä¸ªçŸ¥è¯†ç‚¹ï¼š
- Activiti ä¼šå°†æ‰€æœ‰çš„è¯„è®ºä¿¡æ¯ä¿å­˜åˆ° ACT_HI_COMMENT è¡¨ä¸­
- è¯„è®ºè¡¨çš„ `type` å­—æ®µä¼šåŒºåˆ†ä¸¤ç§ç±»å‹ï¼šä»»åŠ¡è¯„è®ºã€äº‹ä»¶è®°å½•ï¼Œåˆ†åˆ«ä½¿ç”¨ï¼šcommentã€event è¡¨ç¤º

comment ä¸­å‡ ä¸ªå¸¸ç”¨çš„æ–¹æ³•ï¼ˆä½¿ç”¨ taskService ç»„ä»¶ï¼‰ï¼š
- addCommentï¼šæ·»åŠ è¯„è®º
- getTaskCommentsï¼šæŸ¥çœ‹è¯„è®º
- getTaskEventsï¼šæŸ¥çœ‹ä»»åŠ¡çš„äº‹ä»¶è®°å½•
- getProcessInstanceCommentsï¼šæ ¹æ®æµç¨‹å®ä¾‹æŸ¥çœ‹ Comment æ•°æ®ï¼ˆä¸åŒºåˆ†ç±»å‹ï¼‰

**ä»»åŠ¡çš„ä»£ç†å’Œå®Œæˆ**
ç”¨äºæ”¹å˜ä»»åŠ¡çš„çŠ¶æ€ï¼Œå¯ä»¥æŠŠä»»åŠ¡äº¤ç»™åˆ«äººå¤„ç†ï¼ˆä¹Ÿç§°ä»£ç†ï¼‰ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®Œæˆï¼Œä½¿ç”¨çš„æ–¹æ³•å¾ˆç®€å•ï¼Œä¸»è¦ä¹Ÿæ˜¯é€šè¿‡ TaskService ç»„ä»¶å®Œæˆ
- claimï¼šæŠŠä»»åŠ¡è½¬ç§»ç»™åˆ«äººå¤„ç†ï¼Œä¹Ÿç§°ä»»åŠ¡ä»£ç†
- completeï¼šå®Œæˆä»»åŠ¡ï¼Œæµç¨‹è¿›å…¥ä¸‹ä¸€ä¸ªèŠ‚ç‚¹

## æµç¨‹æ§åˆ¶

å¯¹äºæµç¨‹çš„æ§åˆ¶ä¸»è¦æ˜¯ RuntimeService ç»„ä»¶çš„èŒè´£ï¼Œé€šè¿‡ RuntimeService æä¾›çš„ API å¯ä»¥å¯¹æµç¨‹è¿›è¡Œå¯åŠ¨ï¼Œå‰è¿›ç­‰æ“ä½œ
